---
date: "2023-10-21"
title: "API 인터페이스 빠르고 안전하게 만들기"
summary: "swagger-typescript-api"
---

## 문제 상황

사내에서 신규 서비스 출시를 준비하며 개발하던중 비즈니스 로직이 고도화되며, API 인터페이스가 자주 변경되었다.

이를 기존처럼 프론트엔드에서 매번 변화를 감지하고 (혹은 백엔드 개발자가 변경사항을 알려주기) swagger에 schema를 보고 클라이언트 프로젝트에 직접 인터페이스화 시켜 작성하는것이 굉장히 비효율적이라고 느껴졌다.

이 과정에서 변화를 감지하지 못하고 API 인터페이스를 업데이트 해주지 않게 되면 그때 벌어질 일들은 상상도 하고 싶지 않았다.

## 해결 과정

점심 시간때 이 얘기를 꺼냈더니 다른 프론트엔드 개발자분도 크게 불편함을 겪고있었고, 이에 회의를 진행하기로 했다.

회의에서 나온 문제 해결 방법은 크게 3가지가 있었다.

1. API 인터페이스가 변경된 것을 슬랙 채널에 봇을 통해 알리기
2. API 인터페이스 부분만 공용 패키지 모듈로 따로 빼내어 개발하기
3. API 인터페이스 생성기를 만들어 자동화

### API 인터페이스가 변경된 것을 슬랙 채널에 봇을 통해 알리기

이 방법은 API 인터페이스의 변화를 감지하지 못하는 문제만 해결이 가능하고, 심지어 슬랙 알림을 늦게 알아차리게 되면 말짱도루묵이라 바로 기각되었다.

### API 인터페이스 부분만 공용 패키지 모듈로 따로 빼내어 개발하기

대표님이 고안해주신 방법인데, 기존 백엔드와 프론트엔드가 코드베이스를 공유하지 않기 때문에 매번 패키지 인스톨을 해야하고, 관리해야하는 프로젝트가 하나 더 생기게 되는거라 공수 측면에서 백엔드 개발자분들이 반대했다.

### API 인터페이스 생성기를 만들어 자동화

사실 처음 문제를 직면했을때 바로 생각이 들었던 방법이다. 다만 고민이 되었던 부분은 API 인터페이스 생성기를 만드는게 공수가 꽤 많이 들 것 같아 반신반의하였다.

그러던 중 CTO님이 swagger는 결국 OpenAPI Specification (OAS) 라는 규칙으로 문서화 해주는 도구이므로, 이미 해당 도구가 있을 것 같다고 말씀해주셨다.

그렇게 `swagger-typescript-api` 라는 패키지를 알게되었다. 다른 도구들도 있었지만, 조금 더 typescript에 최적화되어있다는 커뮤니티 의견이 있었고, Axios 인스턴스도 생성할 수 있다는 장점이 크게 다가왔다.

## API 인터페이스 생성하기

[공식 문서](https://github.com/acacode/swagger-typescript-api/blob/main/README.md)가 있긴 한데, README.md에 작성되어있고, 옵션 쪽 글 가독성이 정말 좋지 않아 꽤나 고생했다.

우선 처음에 간단하게 작성해본 스크립트는 아래와 같다.

```sh
npx swagger-typescript-api -p https://api-dev.ohoolabs.com/(비밀비밀)/docs-json --no-client
```

이렇게만 작성해도 필요한 API 인터페이스들을 생성되지만 다른 불필요한 코드들도 함께 있어 [다른 분](https://velog.io/@ktw3577/Swagger-%ED%83%80%EC%9E%85-%EC%9E%90%EB%8F%99-%EC%83%9D%EC%84%B1%EA%B8%B0-%EC%A0%81%EC%9A%A9%EA%B8%B0feat.-swagger-typescript-api)이 작성하신 스크립트를 찾아서 조금 수정하여 아래와 같이 작성했다.

```sh
npx swagger-typescript-api -p https://api-dev.ohoolabs.com/(비밀비밀)/docs-json -r -o ./types/api.ts --modular -d --extract-request-body --extract-response-body --extract-response-error --no-client
```

끝이다. API 인터페이스가 변경되었는지의 여부는 여전히 백엔드 개발자분들이 알려주셔야하지만, 가장 불편했던 schema를 보고 인터페이스를 직접 다시 작성해야되는 문제를 위 방법으로 해결하게되어 서비스 개발하면서 루즈해지는 영역을 줄여서 더 집중해서 개발할 수 있을 것 같다.
